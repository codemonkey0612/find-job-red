# 管理者による求人承認へのアクセス方法

## ✅ 実装完了

求人の承認ワークフローが完全に実装され、管理者が承認待ちの求人を受け取ることができるようになりました。

## 📍 アクセス方法

### 方法1: 管理者ダッシュボードから（推奨）

1. **管理者アカウントでログイン**
   - メール: `admin@bizresearch.com`
   - パスワード: `admin123`

2. **ダッシュボードにアクセス**
   - URL: `/admin/dashboard`
   - ナビゲーションメニューから「管理者ダッシュボード」を選択

3. **承認待ち通知を確認**
   - 承認待ちの求人がある場合、ダッシュボードの上部に黄色の通知カードが表示されます
   - 例: **「5件の承認待ち求人があります」**
   
4. **承認管理へボタンをクリック**
   - 通知カード内の「承認管理へ」ボタンをクリック
   - 自動的に承認ページへ移動します

### 方法2: 直接URLでアクセス

管理者アカウントでログイン後、以下のURLに直接アクセス：

```
http://localhost:8080/admin/jobs/approval
```

または本番環境：

```
https://your-domain.com/admin/jobs/approval
```

## 🎯 承認ページの機能

### 表示される情報

各求人について以下の情報が表示されます：

- ✅ **求人情報**
  - タイトル
  - 会社名
  - 勤務地
  - 給与範囲
  - 雇用形態
  - 勤務スタイル
  - 経験レベル
  - 求人詳細
  - 応募要件

- ✅ **投稿者情報**
  - 投稿者名
  - メールアドレス
  - 投稿日時

### 実行可能なアクション

1. **承認する**
   - 緑色の「承認する」ボタンをクリック
   - 求人が即座に公開されます
   - 投稿者に自動通知が送信されます

2. **却下する**
   - 赤色の「却下する」ボタンをクリック
   - 却下理由を入力（最低10文字）
   - 「却下を確定」をクリック
   - 投稿者に却下理由付きの通知が送信されます

## 🔔 通知システム

### 採用担当者が受け取る通知

#### 承認時
- **タイトル**: 「求人が承認されました」
- **メッセージ**: 「あなたの求人「[求人タイトル]」が承認され、公開されました。」

#### 却下時
- **タイトル**: 「求人が却下されました」
- **メッセージ**: 「あなたの求人「[求人タイトル]」が却下されました。理由: [却下理由]」

### 通知の確認方法

採用担当者は以下のAPIエンドポイントで通知を確認できます：

```javascript
GET /api/notifications
Authorization: Bearer {token}
```

## 🔄 フロー全体

```
1. 採用担当者が求人投稿
         ↓
2. 求人が「承認待ち」ステータスで保存
         ↓
3. 管理者ダッシュボードに通知表示
         ↓
4. 管理者が承認ページで確認
         ↓
5a. 承認 → 求人公開 + 通知送信
5b. 却下 → 求人非公開 + 却下理由通知
```

## 🎨 UI要素

### ダッシュボード通知カード
- **背景色**: 黄色（注意を引く）
- **アイコン**: アラート（AlertCircle）
- **ボタン**: 「承認管理へ」
- **表示条件**: 承認待ちの求人が1件以上ある場合

### 承認ページ
- **カラー**: 
  - 承認待ちバッジ: 黄色
  - 承認ボタン: 緑色
  - 却下ボタン: 赤色
- **レイアウト**: カード形式で各求人を表示

## 🔐 セキュリティ

- ✅ 管理者ロール必須（`requiredRole="admin"`）
- ✅ JWT認証必須
- ✅ 非管理者ユーザーは自動的にホームページへリダイレクト

## 📊 データベース

### 承認ステータス

- `pending`: 承認待ち（デフォルト）
- `approved`: 承認済み（公開）
- `rejected`: 却下（非公開）

### 記録される情報

- `approved_by`: 承認/却下した管理者のID
- `approved_at`: 承認/却下日時
- `rejection_reason`: 却下理由（却下時のみ）

## 🧪 テスト方法

1. **採用担当者アカウントで求人投稿**
   ```
   - 新規登録時に「企業・採用担当者」を選択
   - /add-job から求人を投稿
   ```

2. **管理者アカウントでログイン**
   ```
   - admin@bizresearch.com / admin123
   - /admin/dashboard にアクセス
   ```

3. **通知を確認**
   ```
   - 黄色の通知カードが表示されていることを確認
   - カウントが正確であることを確認
   ```

4. **承認ページへ移動**
   ```
   - 「承認管理へ」ボタンをクリック
   - /admin/jobs/approval に移動することを確認
   ```

5. **承認または却下を実行**
   ```
   - 求人の詳細を確認
   - 承認または却下を実行
   - 成功メッセージを確認
   ```

6. **通知を確認（API経由）**
   ```bash
   curl -X GET http://localhost:3001/api/notifications \
     -H "Authorization: Bearer {採用担当者のtoken}"
   ```

## ❗ トラブルシューティング

### 通知カードが表示されない

**原因**: 承認待ちの求人がない

**解決策**: 採用担当者アカウントで求人を投稿してください

### 承認ページにアクセスできない

**原因**: 管理者ロールではない

**解決策**: 
- 管理者アカウントでログインしているか確認
- データベースで`users`テーブルの`role`カラムが`admin`になっているか確認

### 承認/却下後に通知が送信されない

**原因**: notificationsテーブルが存在しない

**解決策**: マイグレーションを実行
```bash
cd /var/www/find-job-red/server
mysql -u jobuser -ppassword job_search_db < database/add_approval_workflow.sql
```

## 🎉 完了

すべての機能が正常に動作しています！管理者は承認待ちの求人を簡単に確認・管理できるようになりました。

